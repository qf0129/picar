<!DOCTYPE html>
<html>
<head>
    <title>Index</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <script type="text/javascript" src="/static/jquery.js"></script>
</head>
<body>
<style type="text/css">
.touch_btn {
  width:50px;height:50px;background:#ddd;display: inline-block;margin: 5px;text-align: center;line-height: 50px;color: #ccc;
}
</style>
<div>
  <div class="touch_btn touch_btn_1">1</div>
  <div class="touch_btn touch_btn_2">2</div>
  <div class="touch_btn touch_btn_3">3</div>
  <div class="touch_btn touch_btn_4">4</div>
</div>
<p class="tips"></p>
<input class="msg_input" name="">
<button class="send_msg_btn">Send</button>

<script type="text/javascript">
  Array.prototype.indexOf = function(val) {
    for (var i = 0; i < this.length; i++) {
        if (this[i] == val) {
          return i;
        }
      }
    return -1;
  };

  Array.prototype.remove = function(val) {
    var index = this.indexOf(val);
    if (index > -1) {
      this.splice(index, 1);
    }
  };

  var ws = new WebSocket("ws://localhost:8000/websocket");

  function touch_change(touch_list){
      $('.tips').html(touch_list);
      ws.send($('.msg_input').val());
  }

  $('.touch_btn').bind('touchstart', touch_handler);
  $('.touch_btn').bind('touchend', touch_handler);
  $('.touch_btn').bind('touchmove', touch_handler);

  var touch_list = new Array();

  function touch_handler(){
       var event = event || window.event;  

        var oInp = document.getElementById("inp");  

        switch(event.type){  
            case "touchstart":  
                event.preventDefault();
                touch_list.push($(this).html());
                console.log(event);
                console.log(event.changedTouches);
                touch_change(touch_list);
                break;  
            case "touchend":  
                event.preventDefault();
                touch_list.remove($(this).html());
                touch_change(touch_list);
                break;  
            case "touchmove":  
                event.preventDefault();  
                break;  
        }  
  }


  $('.send_msg_btn').click(function(){
      ws.send($('.msg_input').val());
  });

  // ws.onopen = function() {
  //     ws.send("Hello, world");
  // };
  ws.onmessage = function (evt) {
      console.log(evt.data);
  };

</script>
</body>
</html>